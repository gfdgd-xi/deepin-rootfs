name: Build deepin base tar
run-name: ${{ github.actor }} Build deepin base tar ðŸš€
on:
  workflow_dispatch:
jobs:
  amd64:
    runs-on: ubuntu-24.04 # 24 æ‰æœ‰æ”¯æŒ loong æ–°ä¸–ç•Œçš„ Qemu User
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build debootstrap
        run: |
          sudo apt update
          sudo apt install git fakeroot -y   # fakeroot ç”¨äºŽè§£å†³æž„å»º deb çš„æƒé™é—®é¢˜
          # æ‹‰å–æºç åŒ…
          git clone https://github.com/deepin-community/debootstrap --depth=1
          cd debootstrap
          # å®‰è£…ç¼–è¯‘ä¾èµ–
          sudo apt build-dep . -y
          # æž„å»º deb åŒ…
          dpkg-buildpackage -b
          # å®‰è£…ç”Ÿæˆçš„ deb åŒ…
          sudo apt install ../*.deb -y
      - name: Get gpg key
        run: |
          sudo cp deepin-archive-camel-keyring.gpg /etc/apt/trusted.gpg.d -rv

      - name: Get deepin base rootfs
        run: |
          sudo debootstrap --arch=amd64 beige deepin-rootfs https://community-packages.deepin.com/deepin/beige/

      - name: Pack tar
        run: |
          cpu=$(cat /proc/cpuinfo | grep processor | wc -l)  # èŽ·å– CPU æ ¸å¿ƒæ•°
          sudo tar -cvf deepin-rootfs.tar deepin-rootfs
          sudo xz -T $cpu deepin-rootfs.tar
          echo "fileName=$(ls -1 deepin-rootfs.tar)" >> $GITHUB_OUTPUT

      - name: Upload tar
        uses: actions/upload-artifact@v1
        with:
          name: deepin-rootfs-amd64
          path: deepin-rootfs.tar
      
    